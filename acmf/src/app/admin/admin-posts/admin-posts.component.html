<div class="p-6 bg-gray-50 min-h-screen">
    <h2 class="text-2xl font-semibold mb-6 text-gray-800">Posts Moderation</h2>
    <p class="-mt-4 text-sm">Moderate posts & flags like a pro</p>
  
    <!-- Tabs -->
    <div class="flex space-x-2 mt-4 mb-6 border-b">
      <button
        *ngFor="let tab of tabs"
        (click)="activeTab = tab.key"
        class="px-4 py-2 rounded-t-lg text-sm font-medium transition-all duration-300"
        [ngClass]="
          activeTab === tab.key
            ? 'bg-blue-50 text-blue-600 border-b-2 border-blue-600 shadow-sm'
            : 'text-gray-500 hover:text-gray-700 hover:bg-gray-100'
        "
      >
        {{ tab.label }}
      </button>
    </div>
  
    <!-- Loading -->
    <div *ngIf="loading" class="flex justify-center py-10">
      <div class="animate-spin rounded-full h-10 w-10 border-t-4 border-blue-500 border-b-4 border-gray-300"></div>
    </div>
  
    <!-- Error -->
    <div *ngIf="error" class="text-red-700 bg-red-100 p-4 rounded-2xl shadow-md mb-4">
      {{ error }}
    </div>
  
    <!-- ALL POSTS TAB -->
    <div *ngIf="!loading && activeTab === 'ALL'">
      <!-- Bulk bar -->
      <div *ngIf="selectedPostIds.size > 0" class="mb-4 flex flex-wrap items-center justify-between bg-blue-50 border border-blue-200 p-3 rounded-xl shadow-sm">
        <div class="text-sm text-gray-700">{{ selectedPostIds.size }} selected</div>
        <div class="flex space-x-2 mt-2 sm:mt-0">
          <button (click)="bulkSoftDelete()" class="px-3 py-1 text-xs rounded-lg bg-yellow-100 text-yellow-700 hover:bg-yellow-200 transition">Soft Delete</button>
          <button (click)="bulkRestore()" class="px-3 py-1 text-xs rounded-lg bg-green-100 text-green-700 hover:bg-green-200 transition">Restore</button>
          <button (click)="bulkClearFlagsForSelection()" class="px-3 py-1 text-xs rounded-lg bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition">Clear Flags</button>
        </div>
      </div>
  
      <!-- Search -->
      <div class="flex justify-between items-center mt-4 mb-2">
        <input
          type="text"
          placeholder="Search by title, body, author, institution..."
          [(ngModel)]="searchTerm"
          (input)="applySearch()"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-1/3"
        />
      </div>
  
      <!-- Table -->
      <div class="bg-white rounded-2xl shadow overflow-x-auto">
        <table class="w-full table-auto divide-y divide-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-3 py-3">
                <input
                  type="checkbox"
                  [checked]="selectAllChecked"
                  (change)="toggleSelectAll()"
                  class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                />
              </th>
              <th class="px-3 py-3 text-left text-sm font-semibold text-gray-700">Post</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700 hidden md:table-cell">Author</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700 hidden md:table-cell">Created</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700 hidden md:table-cell text-center">Likes</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700 hidden md:table-cell text-center">Comments</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700">Status</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700 text-right">Actions</th>
            </tr>
          </thead>
  
          <tbody class="divide-y divide-gray-100">
            <tr *ngFor="let p of paginatedPosts" class="hover:bg-gray-50 transition">
              <td class="px-3 py-4">
                <input
                  type="checkbox"
                  [checked]="selectedPostIds.has(p.id)"
                  (change)="togglePostSelection(p.id)"
                  class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                />
              </td>
  
              <td class="px-3 py-4">
                <div class="font-medium text-gray-900 truncate">{{ p.title }}</div>
                <div class="text-xs text-gray-500 truncate" *ngIf="p.body">{{ p.body }}</div>
                <a *ngIf="p.fileUrl" [href]="p.fileUrl" target="_blank" class="text-xs text-indigo-600 hover:underline">View file</a>
              </td>
  
              <td class="px-3 py-4 hidden md:table-cell">
                <div class="flex items-center space-x-2">
                  <img [src]="p.author.profile.profileImage" class="h-8 w-8 rounded-full object-cover" />
                  <div>
                    <div class="text-sm text-gray-900">{{ p.author.name }}</div>
                    <div class="text-xs text-gray-500">{{ p.author.profile.institution }}</div>
                  </div>
                </div>
              </td>
  
              <td class="px-3 py-4 hidden md:table-cell text-sm text-gray-600">
                {{ p.createdAt | date: 'medium' }}
              </td>
  
              <td class="px-3 py-4 hidden md:table-cell text-center text-sm text-gray-700">
                {{ p.likesCount }}
              </td>
  
              <td class="px-3 py-4 hidden md:table-cell text-center text-sm text-gray-700">
                {{ p.commentsCount }}
              </td>
  
              <td class="px-3 py-4">
                <span
                  class="px-2 py-1 text-xs font-medium rounded-full"
                  [ngClass]="p.isDeleted ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'"
                >
                  {{ p.isDeleted ? 'DELETED' : 'ACTIVE' }}
                </span>
              </td>
  
              <td class="px-3 py-4 text-right space-x-1">
                <button
                  *ngIf="!p.isDeleted"
                  (click)="softDelete(p)"
                  class="px-2 py-1 text-xs rounded-lg bg-yellow-100 text-yellow-700 hover:bg-yellow-200 transition"
                >
                  Soft Delete
                </button>
                <button
                  *ngIf="p.isDeleted"
                  (click)="restore(p)"
                  class="px-2 py-1 text-xs rounded-lg bg-green-100 text-green-700 hover:bg-green-200 transition"
                >
                  Restore
                </button>
                <button
                  (click)="hardDelete(p)"
                  class="px-2 py-1 text-xs rounded-lg bg-red-100 text-red-700 hover:bg-red-200 transition"
                >
                  Hard Delete
                </button>
              </td>
            </tr>
  
            <tr *ngIf="paginatedPosts.length === 0">
              <td colspan="8" class="text-center py-4 text-gray-500">No posts found</td>
            </tr>
          </tbody>
        </table>
  
        <!-- Pagination -->
        <div *ngIf="totalPages > 0 && paginatedPosts.length > 0" class="flex flex-wrap justify-between px-3 py-4 border-t border-gray-200">
          <div class="text-sm text-gray-600">
            Showing {{ (page - 1) * limit + 1 }} to {{ Math.min(page * limit, filteredPosts.length) }} of {{ filteredPosts.length }} results
          </div>
  
          <div class="flex items-center space-x-1 mt-2 sm:mt-0">
            <button (click)="setPage(page - 1)" [disabled]="page === 1" class="px-3 py-1.5 text-sm rounded-full border border-gray-300 text-gray-600 bg-white hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed transition">
              Previous
            </button>
  
            <ng-container *ngFor="let p of getPaginationRange()">
              <button
                *ngIf="p !== '...'; else dots"
                (click)="setPage(p)"
                [class.bg-blue-600]="page === p"
                [class.text-white]="page === p"
                [class.border-blue-600]="page === p"
                class="px-3 py-1.5 text-sm rounded-full border border-gray-300 text-gray-700 hover:bg-gray-100 transition"
              >
                {{ p }}
              </button>
              <ng-template #dots>
                <span class="px-3 py-1.5 text-sm text-gray-400">…</span>
              </ng-template>
            </ng-container>
  
            <button (click)="setPage(page + 1)" [disabled]="page === totalPages" class="px-3 py-1.5 text-sm rounded-full border border-gray-300 text-gray-600 bg-white hover:bg-gray-100 disabled:opacity-40 disabled:cursor-not-allowed transition">
              Next
            </button>
          </div>
        </div>
      </div>
    </div>
  
    <!-- FLAGGED TAB -->
    <div *ngIf="!loading && activeTab === 'FLAGGED'">
      <div class="bg-white rounded-2xl shadow overflow-x-auto">
        <table class="w-full table-auto divide-y divide-gray-200">
          <thead class="bg-gray-100">
            <tr>
              <th class="px-3 py-3">Flag</th>
              <th class="px-3 py-3 text-left text-sm font-semibold text-gray-700">Post</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700 hidden md:table-cell">Reporter</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700">Status</th>
              <th class="px-3 py-3 text-sm font-semibold text-gray-700 text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">
            <tr *ngFor="let f of flagged" class="hover:bg-gray-50 transition">
              <td class="px-3 py-4 text-xs text-gray-500">
                <div>Reason: <span class="font-medium text-gray-800">{{ f.reason }}</span></div>
                <div>Flagged: {{ f.createdAt | date: 'medium' }}</div>
              </td>
  
              <td class="px-3 py-4">
                <div class="font-medium text-gray-900">{{ f.post.title }}</div>
                <div class="text-xs text-gray-500 truncate" *ngIf="f.post.body">{{ f.post.body }}</div>
                <div class="flex items-center space-x-2 mt-1">
                  <img [src]="f.post.author.profile.profileImage" class="h-6 w-6 rounded-full object-cover" />
                  <div class="text-xs text-gray-600">{{ f.post.author.name }} · {{ f.post.author.profile.institution }}</div>
                </div>
              </td>
  
              <td class="px-3 py-4 hidden md:table-cell">
                <div class="flex items-center space-x-2">
                  <img [src]="f.reporter.profile.profileImage" class="h-6 w-6 rounded-full object-cover" />
                  <div class="text-xs text-gray-700">
                    {{ f.reporter.name }} · {{ f.reporter.profile.institution }}
                  </div>
                </div>
              </td>
  
              <td class="px-3 py-4">
                <select
                  class="px-2 py-1 text-xs border rounded-lg"
                  [ngModel]="f.status"
                  (ngModelChange)="setFlagStatus(f, $event)"
                >
                  <option value="PENDING">PENDING</option>
                  <option value="REVIEWED">REVIEWED</option>
                  <option value="RESOLVED">RESOLVED</option>
                </select>
              </td>
  
              <td class="px-3 py-4 text-right space-x-1">
                <button
                  *ngIf="!f.post.isDeleted"
                  (click)="softDeleteFromFlag(f)"
                  class="px-2 py-1 text-xs rounded-lg bg-yellow-100 text-yellow-700 hover:bg-yellow-200 transition"
                >
                  Soft Delete
                </button>
                <button
                  *ngIf="f.post.isDeleted"
                  (click)="restoreFromFlag(f)"
                  class="px-2 py-1 text-xs rounded-lg bg-green-100 text-green-700 hover:bg-green-200 transition"
                >
                  Restore
                </button>
              </td>
            </tr>
  
            <tr *ngIf="flagged.length === 0">
              <td colspan="5" class="text-center py-4 text-gray-500">No flagged posts</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  
    <!-- Confirm Modal -->
    <div *ngIf="confirmAction.show" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50">
      <div class="bg-white rounded-2xl shadow-lg w-full max-w-sm p-6 animate-fadeIn">
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Confirm Action</h3>
        <p class="text-sm text-gray-600 mb-6">{{ confirmAction.message }}</p>
        <div class="flex justify-end space-x-2">
          <button (click)="closeConfirm()" class="px-4 py-2 text-sm rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 transition">Cancel</button>
          <button (click)="confirmAction.onConfirm && confirmAction.onConfirm()" class="px-4 py-2 text-sm rounded-lg bg-red-500 text-white hover:bg-red-600 transition">Confirm</button>
        </div>
      </div>
    </div>
  </div>
  