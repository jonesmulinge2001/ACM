<div class="min-h-screen bg-gray-50">
    <!-- Search Header - LinkedIn Style -->
    <div class="bg-white border-b border-gray-200 sticky top-0 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex flex-col space-y-4">
          <!-- Search Bar -->
          <div class="flex-1">
            <div class="relative max-w-3xl">
              <div
                class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"
              >
                <span class="material-icons text-gray-500">
                  search
                </span>
              </div>
              <input
                type="search"
                [(ngModel)]="query"
                (keyup)="searchOnEnter($event)"
                placeholder="Search for people, posts, resources..."
                class="w-full pl-12 pr-32 py-3.5 border border-gray-300 rounded-lg bg-gray-50 text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:bg-white text-base transition-all duration-200 hover:bg-gray-100"
              />
              <div class="absolute inset-y-0 right-0 flex items-center pr-2">
                <button
                  (click)="performSearch()"
                  class="px-5 py-2.5 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-blue-500 transition-colors duration-200 text-sm font-medium shadow-sm"
                >
                  Search
                </button>
              </div>
            </div>
          </div>
  
          <!-- Results Summary -->
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-700">
              <span *ngIf="query.trim() && !loading" class="font-medium">
                {{ totalResults.toLocaleString() }} result{{
                  totalResults !== 1 ? "s" : ""
                }}
                for
                <span class="text-gray-900">"{{ query }}"</span>
              </span>
            </div>
            <div
              *ngIf="!loading && totalResults > 0"
              class="text-sm text-gray-500"
            >
              <span class="hidden sm:inline">Try searching for:</span>
              <button class="ml-2 text-blue-600 hover:text-blue-800 font-medium">
                People
              </button>
              <button class="ml-3 text-blue-600 hover:text-blue-800 font-medium">
                Posts
              </button>
              <button class="ml-3 text-blue-600 hover:text-blue-800 font-medium">
                Documents
              </button>
            </div>
          </div>
        </div>
  
        <!-- Tabs - LinkedIn Inspired -->
        <div class="mt-6">
          <div class="border-b border-gray-200">
            <nav class="-mb-px flex space-x-1 overflow-x-auto">
              <button
                (click)="setActiveTab('all')"
                [class]="
                  activeTab === 'all'
                    ? 'border-blue-600 text-blue-600 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm'
                    : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm transition-colors duration-200'
                "
              >
                All
                <span
                  *ngIf="totalResults > 0"
                  class="ml-2 py-0.5 px-2.5 text-xs rounded-full bg-blue-100 text-blue-700"
                >
                  {{ totalResults }}
                </span>
              </button>
  
              <button
                (click)="setActiveTab('profiles')"
                [class]="
                  activeTab === 'profiles'
                    ? 'border-blue-600 text-blue-600 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm'
                    : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm transition-colors duration-200'
                "
              >
                People
                <span
                  *ngIf="results.profiles.length > 0"
                  class="ml-2 py-0.5 px-2.5 text-xs rounded-full bg-gray-100 text-gray-700"
                >
                  {{ results.profiles.length }}
                </span>
              </button>
  
              <button
                (click)="setActiveTab('posts')"
                [class]="
                  activeTab === 'posts'
                    ? 'border-blue-600 text-blue-600 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm'
                    : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm transition-colors duration-200'
                "
              >
                Posts
                <span
                  *ngIf="results.posts.length > 0"
                  class="ml-2 py-0.5 px-2.5 text-xs rounded-full bg-gray-100 text-gray-700"
                >
                  {{ results.posts.length }}
                </span>
              </button>
  
              <button
                (click)="setActiveTab('resources')"
                [class]="
                  activeTab === 'resources'
                    ? 'border-blue-600 text-blue-600 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm'
                    : 'border-transparent text-gray-600 hover:text-gray-800 hover:border-gray-300 whitespace-nowrap py-3 px-4 border-b-2 font-medium text-sm transition-colors duration-200'
                "
              >
                Resources
                <span
                  *ngIf="results.resources.length > 0"
                  class="ml-2 py-0.5 px-2.5 text-xs rounded-full bg-gray-100 text-gray-700"
                >
                  {{ results.resources.length }}
                </span>
              </button>
            </nav>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Loading State -->
      <div
        *ngIf="loading"
        class="flex flex-col items-center justify-center py-20"
      >
        <div class="relative">
          <div
            class="animate-spin rounded-full h-14 w-14 border-4 border-gray-200"
          ></div>
          <div
            class="absolute top-0 left-0 animate-spin rounded-full h-14 w-14 border-t-4 border-blue-600"
          ></div>
        </div>
        <p class="mt-4 text-gray-600 font-medium">
          Finding results for "{{ query }}"...
        </p>
      </div>
  
      <!-- Error State -->
      <div
        *ngIf="error && !loading"
        class="max-w-2xl mx-auto bg-white rounded-xl border border-gray-200 p-8 text-center shadow-sm"
      >
        <div
          class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4"
        >
          <span class="material-icons text-red-600 text-3xl">
            error_outline
          </span>
        </div>
        <h3 class="text-lg font-semibold text-gray-900 mb-2">Search error</h3>
        <p class="text-gray-600 mb-6">{{ error }}</p>
        <button
          (click)="performSearch()"
          class="px-5 py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200 font-medium"
        >
          Try Again
        </button>
      </div>
  
      <!-- Results -->
      <div *ngIf="!loading && !error">
        <!-- Empty State -->
        <div
          *ngIf="query.trim() && totalResults === 0"
          class="max-w-xl mx-auto text-center py-16"
        >
          <div
            class="inline-flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mb-6"
          >
            <span class="material-icons text-gray-400 text-4xl">
              sentiment_dissatisfied
            </span>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 mb-3">
            No results found
          </h3>
          <p class="text-gray-600 mb-6">
            We couldn't find any matches for
            <span class="text-gray-900 font-medium">"{{ query }}"</span>.
          </p>
          <div class="space-y-3">
            <p class="text-sm text-gray-500">Try adjusting your search:</p>
            <ul class="text-sm text-gray-600 space-y-1">
              <li>• Check your spelling</li>
              <li>• Use more general keywords</li>
              <li>• Try different search terms</li>
            </ul>
          </div>
        </div>
  
        <!-- Results Content -->
        <div *ngIf="query.trim() && totalResults > 0" class="space-y-8">
          <!-- People Section -->
          <section
            *ngIf="
              (activeTab === 'all' || activeTab === 'profiles') &&
              results.profiles.length
            "
            class="bg-white rounded-xl border border-gray-200 overflow-hidden"
          >
            <div class="px-6 py-5 border-b border-gray-100 bg-gray-50">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="text-lg font-semibold text-gray-900">People</h2>
                  <p class="text-sm text-gray-600 mt-1">
                    {{ results.profiles.length }} student{{
                      results.profiles.length !== 1 ? "s" : ""
                    }}
                    found
                  </p>
                </div>
                <button
                  class="text-sm text-blue-600 hover:text-blue-800 font-medium"
                >
                  View all
                </button>
              </div>
            </div>
  
            <div class="divide-y divide-gray-100">
              <div
                *ngFor="let profile of results.profiles"
                class="p-6 hover:bg-gray-50 transition-colors duration-150 cursor-pointer"
              >
                <div class="flex items-start space-x-4">
                  <div class="relative">
                    <img
                      [src]="
                        profile.profileImage || 'https://via.placeholder.com/96'
                      "
                      [alt]="profile.name"
                      class="w-16 h-16 rounded-full object-cover border-2 border-white shadow-sm"
                    />
                    <div
                      class="absolute bottom-0 right-0 w-4 h-4 bg-green-500 rounded-full border-2 border-white"
                    ></div>
                  </div>
  
                  <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between">
                      <div>
                        <h3
                          class="text-base font-semibold text-gray-900 hover:text-blue-600"
                        >
                          {{ profile.name }}
                        </h3>
                        <p class="text-sm text-gray-600 mt-0.5">
                          {{ profile.course }}
                        </p>
  
                        <div class="flex items-center mt-2 space-x-3">
                          <span
                            *ngIf="profile.academicLevel"
                            class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-100"
                          >
                            Year {{ profile.academicLevel }}
                          </span>
                          <span
                            *ngIf="profile.course"
                            class="text-xs text-gray-500 flex items-center"
                          >
                            <span class="material-icons text-xs mr-1">
                              location_on
                            </span>
                            {{ profile.course }}
                          </span>
                        </div>
                      </div>
  
                      <button
                        class="px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-800 border border-blue-200 hover:border-blue-300 rounded-lg transition-colors duration-200"
                      >
                        Connect
                      </button>
                    </div>
  
                    <div *ngIf="profile?.interests?.length" class="mt-4">
                      <p class="text-xs text-gray-500 mb-2">Interests</p>
                      <div class="flex flex-wrap gap-2">
                        <span
                          *ngFor="let interest of profile.interests.slice(0, 4)"
                          class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100 transition-colors"
                        >
                          {{ interest }}
                        </span>
                        <span
                          *ngIf="profile.interests.length > 4"
                          class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium text-gray-500"
                        >
                          +{{ profile.interests.length - 4 }} more
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
  
          <!-- Posts Section -->
          <section
            *ngIf="
              (activeTab === 'all' || activeTab === 'posts') &&
              results.posts.length
            "
            class="bg-white rounded-xl border border-gray-200 overflow-hidden"
          >
            <div class="px-6 py-5 border-b border-gray-100 bg-gray-50">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="text-lg font-semibold text-gray-900">
                    Posts & Discussions
                  </h2>
                  <p class="text-sm text-gray-600 mt-1">
                    {{ results.posts.length }} post{{
                      results.posts.length !== 1 ? "s" : ""
                    }}
                    found
                  </p>
                </div>
                <button
                  class="text-sm text-blue-600 hover:text-blue-800 font-medium"
                >
                  View all
                </button>
              </div>
            </div>
  
            <div class="divide-y divide-gray-100">
              <div
                *ngFor="let post of results.posts"
                class="p-6 hover:bg-gray-50 transition-colors duration-150 cursor-pointer"
              >
                <div class="flex items-start space-x-4">
                  <!-- Fix: Check if author exists before accessing properties -->
                  <img
                    [src]="
                      post?.author?.profileImage ||
                      'https://via.placeholder.com/40'
                    "
                    [alt]="post?.author?.name"
                    class="w-10 h-10 rounded-full object-cover flex-shrink-0"
                  />
  
                  <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between">
                      <div>
                        <h3
                          class="text-base font-semibold text-gray-900 mb-2 hover:text-blue-600"
                        >
                          {{ post.title }}
                        </h3>
                        <!-- Fix: Check author existence and use conditional display -->
                        <div
                          *ngIf="post.author"
                          class="flex items-center text-sm text-gray-600 space-x-3"
                        >
                          <span class="font-medium">{{ post.author.name }}</span>
                          <span *ngIf="post.author.institution?.name"
                            >• {{ post.author.institution?.name }}</span
                          >
                          <span *ngIf="post.author.academicLevel"
                            >• Year {{ post.author.academicLevel }}</span
                          >
                        </div>
  
                        <!-- Date and read time -->
                        <div
                          class="flex items-center text-sm text-gray-500 mt-1 space-x-3"
                        >
                          <span>{{ post.createdAt | date : "MMM d, y" }}</span>
                          <span>•</span>
                          <span class="flex items-center">
                            <span class="material-icons text-gray-400 text-sm mr-1">
                              schedule
                            </span>
                            {{ post.readTime || "3 min read" }}
                          </span>
                        </div>
                      </div>
                    </div>
  
                    <p *ngIf="post.body" class="mt-3 text-gray-700 line-clamp-3">
                      {{ post.body }}
                    </p>
  
                    <!-- Tags if available -->
                    <div
                      *ngIf="post.tags?.length"
                      class="mt-3 flex flex-wrap gap-2"
                    >
                      <span
                        *ngFor="let tag of post.tags"
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-100"
                      >
                        {{ tag }}
                      </span>
                    </div>
  
                    <div *ngIf="post.fileUrl" class="mt-4">
                      <img
                        [src]="post.fileUrl"
                        [alt]="post.title"
                        class="w-full max-w-md h-48 object-cover rounded-lg"
                      />
                    </div>
  
                    <div
                      class="flex items-center justify-between mt-6 pt-4 border-t border-gray-100"
                    >
                      <div class="flex items-center space-x-4">
                        <button
                          class="flex items-center text-sm text-gray-600 hover:text-blue-600"
                        >
                          <span class="material-icons text-base mr-1.5">
                            thumb_up
                          </span>
                          {{ post.likesCount || 0 }}
                        </button>
                        <button
                          class="flex items-center text-sm text-gray-600 hover:text-blue-600"
                        >
                          <span class="material-icons text-base mr-1.5">
                            comment
                          </span>
                          {{ post.comments || 0 }}
                        </button>
                        <button
                          class="flex items-center text-sm text-gray-600 hover:text-blue-600"
                        >
                          <span class="material-icons text-base mr-1.5">
                            share
                          </span>
                          Share
                        </button>
                      </div>
                      <div class="flex items-center space-x-2">
                        <!-- Post type badge -->
                        <span
                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize"
                          [class]="{
                            'bg-gray-100 text-gray-800': post.type === 'GENERAL',
                            'bg-blue-100 text-blue-800': post.type === 'ACADEMIC',
                            'bg-green-100 text-green-800':
                              post.type === 'RESOURCE',
                            'bg-purple-100 text-purple-800':
                              post.type === 'opportunity',
                            'bg-yellow-100 text-yellow-800': ![
                              'GENERAL',
                              'ACADEMIC',
                              'RESOURCE',
                              'opportunity'
                            ].includes(post.type)
                          }"
                        >
                          {{ post?.type?.toLowerCase() }}
                        </span>
                        <button class="text-gray-500 hover:text-gray-700">
                          <span class="material-icons text-base">
                            more_vert
                          </span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
  
          <!-- Resources Section -->
          <section
            *ngIf="
              (activeTab === 'all' || activeTab === 'resources') &&
              results.resources.length
            "
            class="bg-white rounded-xl border border-gray-200 overflow-hidden"
          >
            <div class="px-6 py-5 border-b border-gray-100 bg-gray-50">
              <div class="flex items-center justify-between">
                <div>
                  <h2 class="text-lg font-semibold text-gray-900">
                    Learning Resources
                  </h2>
                  <p class="text-sm text-gray-600 mt-1">
                    {{ results.resources.length }} resource{{
                      results.resources.length !== 1 ? "s" : ""
                    }}
                    found
                  </p>
                </div>
                <button
                  class="text-sm text-blue-600 hover:text-blue-800 font-medium"
                >
                  View all
                </button>
              </div>
            </div>
  
            <div class="divide-y divide-gray-100">
              <div
                *ngFor="let resource of results.resources"
                class="p-6 hover:bg-gray-50 transition-colors duration-150 cursor-pointer"
              >
                <div class="flex items-start space-x-4">
                  <div class="flex-shrink-0">
                    <div
                      [class]="
                        'w-12 h-12 rounded-lg flex items-center justify-center ' +
                        (resource.type === 'pdf'
                          ? 'bg-red-100 text-red-600'
                          : resource.type === 'video'
                          ? 'bg-purple-100 text-purple-600'
                          : resource.type === 'slide'
                          ? 'bg-yellow-100 text-yellow-600'
                          : 'bg-blue-100 text-blue-600')
                      "
                    >
                      <span class="material-icons">
                        description
                      </span>
                    </div>
                  </div>
  
                  <div class="flex-1 min-w-0">
                    <div class="flex items-start justify-between">
                      <div>
                        <h3
                          class="text-base font-semibold text-gray-900 mb-1 hover:text-blue-600"
                        >
                          {{ resource.title }}
                        </h3>
                        <p class="text-sm text-gray-600">
                          {{ resource.course }} • {{ resource.unitName }}
                        </p>
                      </div>
                      <button
                        class="flex items-center text-sm text-blue-600 hover:text-blue-800 font-medium"
                      >
                        <span class="material-icons text-base mr-1">
                          download
                        </span>
                        Download
                      </button>
                    </div>
  
                    <div class="flex items-center mt-3 space-x-4">
                      <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize"
                        [class]="
                          resource.type === 'pdf'
                            ? 'bg-red-100 text-red-800'
                            : resource.type === 'video'
                            ? 'bg-purple-100 text-purple-800'
                            : resource.type === 'slide'
                            ? 'bg-yellow-100 text-yellow-800'
                            : 'bg-gray-100 text-gray-800'
                        "
                      >
                        {{ resource.type }}
                      </span>
                      <span class="text-sm text-gray-500 flex items-center">
                        <span class="material-icons text-base mr-1">
                          access_time
                        </span>
                        {{ resource.size || "1.5 MB" }}
                      </span>
                      <span class="text-sm text-gray-500">
                        {{ resource.uploadedAt | date : "MMM d" }}
                      </span>
                      <span
                        *ngIf="resource.downloads"
                        class="text-sm text-gray-500"
                      >
                        {{ resource.downloads }} downloads
                      </span>
                    </div>
  
                    <div *ngIf="resource.description" class="mt-3">
                      <p class="text-sm text-gray-600 line-clamp-2">
                        {{ resource.description }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>