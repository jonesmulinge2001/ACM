<div class="bg-white rounded-lg shadow overflow-hidden">
  <ng-container *ngIf="group$ | async as group">
    <!-- Cover + Header -->
<!-- COVER IMAGE ONLY -->
<!-- <div class="bg-gray-100 border-b border-gray-200">
  <div class="w-full aspect-[16/5] flex items-center justify-center overflow-hidden">
    <img
      *ngIf="group.coverImage"
      [src]="group.coverImage"
      alt="Group cover"
      class="max-w-full max-h-full object-contain"
    />
  </div>
</div> -->

<!-- GROUP DETAILS -->
<div class="bg-white px-6 py-5 border-b border-gray-200">
  <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">

    <!-- LEFT: INFO -->
    <div class="flex items-start gap-4">
      <!-- Avatar -->
      <div class="bg-gray-100 rounded-lg p-1">
        <img
          *ngIf="group.coverImage"
          [src]="group.coverImage"
          alt="Group avatar"
          class="w-20 h-full object-contain rounded-md"
        />
      </div>

      <!-- Text -->
      <div>
        <h1 class="text-xl sm:text-2xl font-semibold text-gray-900">
          {{ group.name }}
        </h1>

        <p class="mt-1 text-sm sm:text-base text-gray-600 max-w-2xl">
          {{ group.description }}
        </p>

        <div class="mt-2 text-sm text-gray-500">
          {{ group.members?.length || 0 }} members
        </div>
      </div>
    </div>

    <!-- RIGHT: ACTIONS -->
    <div class="flex items-center gap-2">
      <button
        *ngIf="!joined"
        (click)="join()"
        class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-full hover:bg-blue-700 transition"
      >
        Join
      </button>

      <button
        *ngIf="joined"
        (click)="leave()"
        class="px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-full hover:bg-gray-300 transition"
      >
        Leave
      </button>

      <ng-container *ngIf="auth.currentUser$ | async as user">
        <button
          *ngIf="isGroupAdminOrOwner(group, user?.userId)"
          (click)="editing = true"
          class="px-4 py-2 bg-white border text-gray-700 text-sm font-medium rounded-full hover:bg-gray-50"
        >
          Edit
        </button>
      </ng-container>
    </div>
  </div>

  <!-- Edit Modal -->
  <app-edit-group
    *ngIf="editing && group"
    [group]="group"
    (updated)="onGroupUpdated($event)"
    (cancel)="editing = false"
  ></app-edit-group>
</div>


    <!-- Tabs -->
    <div class="flex w-full border-b border-gray-200">
      <!-- Feed Tab -->
      <button
        (click)="activeTab = 'feed'"
        class="flex-1 min-w-0 flex items-center justify-center px-2 py-3 sm:py-4 relative group transition-all duration-200"
        [class.text-blue-700]="activeTab === 'feed'"
        [class.text-gray-600]="activeTab !== 'feed'"
      >
        <div class="flex flex-col items-center gap-1 sm:gap-2">
          <!-- Icon Container -->
          <div
            class="p-2 rounded-lg transition-all duration-200"
            [class]="
              activeTab === 'feed'
                ? 'bg-blue-50 text-blue-700'
                : 'group-hover:bg-gray-100 text-gray-500 group-hover:text-gray-700'
            "
          >
            <span class="material-icons text-[18px] sm:text-[20px]"
              >dynamic_feed</span
            >
          </div>

          <!-- Label -->
          <span class="text-xs sm:text-sm font-medium truncate">Feed</span>

          <!-- Active Indicator -->
          <div
            class="absolute bottom-0 left-0 right-0 h-0.5 transition-all duration-300"
            [class]="
              activeTab === 'feed'
                ? 'bg-blue-700 scale-100'
                : 'bg-transparent scale-0 group-hover:bg-gray-300 group-hover:scale-100'
            "
          ></div>
        </div>
      </button>

      <!-- Chat Tab -->
      <!-- <button
        (click)="activeTab = 'chat'"
        class="flex-1 min-w-0 flex items-center justify-center px-2 py-3 sm:py-4 relative group transition-all duration-200"
        [class.text-blue-700]="activeTab === 'chat'"
        [class.text-gray-600]="activeTab !== 'chat'"
      >
        <div class="flex flex-col items-center gap-1 sm:gap-2">
          
          <div
            class="p-2 rounded-lg transition-all duration-200"
            [class]="
              activeTab === 'chat'
                ? 'bg-blue-50 text-blue-700'
                : 'group-hover:bg-gray-100 text-gray-500 group-hover:text-gray-700'
            "
          >
            <span class="material-icons text-[18px] sm:text-[20px]">chat</span>
          </div>

         
          <span class="text-xs sm:text-sm font-medium truncate">Chat</span>

          
          <div
            class="absolute bottom-0 left-0 right-0 h-0.5 transition-all duration-300"
            [class]="
              activeTab === 'chat'
                ? 'bg-blue-700 scale-100'
                : 'bg-transparent scale-0 group-hover:bg-gray-300 group-hover:scale-100'
            "
          ></div>
        </div>
      </button> -->

      <!-- Members Tab -->
      <button
        (click)="activeTab = 'members'"
        class="flex-1 min-w-0 flex items-center justify-center px-2 py-3 sm:py-4 relative group transition-all duration-200"
        [class.text-blue-700]="activeTab === 'members'"
        [class.text-gray-600]="activeTab !== 'members'"
      >
        <div class="flex flex-col items-center gap-1 sm:gap-2">
          <!-- Icon Container -->
          <div
            class="p-2 rounded-lg transition-all duration-200 relative"
            [class]="
              activeTab === 'members'
                ? 'bg-blue-50 text-blue-700'
                : 'group-hover:bg-gray-100 text-gray-500 group-hover:text-gray-700'
            "
          >
            <span class="material-icons text-[18px] sm:text-[20px]">group</span>

            <!-- Badge -->
            <div
              class="absolute -top-1 -right-1 min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full text-[10px] font-bold"
              [class]="
                activeTab === 'members'
                  ? 'bg-blue-700 text-white'
                  : 'bg-gray-300 text-gray-700 group-hover:bg-gray-400'
              "
            >
              {{ group.members?.length || 0 }}
            </div>
          </div>

          <!-- Label -->
          <span class="text-xs sm:text-sm font-medium truncate">Members</span>

          <!-- Active Indicator -->
          <div
            class="absolute bottom-0 left-0 right-0 h-0.5 transition-all duration-300"
            [class]="
              activeTab === 'members'
                ? 'bg-blue-700 scale-100'
                : 'bg-transparent scale-0 group-hover:bg-gray-300 group-hover:scale-100'
            "
          ></div>
        </div>
      </button>

      <!-- Resources Tab -->
      <button
        (click)="activeTab = 'resources'"
        class="flex-1 min-w-0 flex items-center justify-center px-2 py-3 sm:py-4 relative group transition-all duration-200"
        [class.text-blue-700]="activeTab === 'resources'"
        [class.text-gray-600]="activeTab !== 'resources'"
      >
        <div class="flex flex-col items-center gap-1 sm:gap-2">
          <!-- Icon Container -->
          <div
            class="p-2 rounded-lg transition-all duration-200 relative"
            [class]="
              activeTab === 'resources'
                ? 'bg-blue-50 text-blue-700'
                : 'group-hover:bg-gray-100 text-gray-500 group-hover:text-gray-700'
            "
          >
            <span class="material-icons text-[18px] sm:text-[20px]"
              >folder</span
            >

            <!-- Badge -->
            <div
              class="absolute -top-1 -right-1 min-w-[18px] h-[18px] flex items-center justify-center px-1 rounded-full text-[10px] font-bold"
              [class]="
                activeTab === 'resources'
                  ? 'bg-blue-700 text-white'
                  : 'bg-gray-300 text-gray-700 group-hover:bg-gray-400'
              "
            >
              {{ group.resources?.length || 0 }}
            </div>
          </div>

          <!-- Label -->
          <span class="text-xs sm:text-sm font-medium truncate">Resources</span>

          <!-- Active Indicator -->
          <div
            class="absolute bottom-0 left-0 right-0 h-0.5 transition-all duration-300"
            [class]="
              activeTab === 'resources'
                ? 'bg-blue-700 scale-100'
                : 'bg-transparent scale-0 group-hover:bg-gray-300 group-hover:scale-100'
            "
          ></div>
        </div>
      </button>
    </div>

    <!-- Tab Content -->
    <div class="w-full">
      <!-- FEED -->
      <ng-container *ngIf="activeTab === 'feed'">
        <!-- Composer & Feed -->
        <div *ngIf="joined">
          <app-group-feed [groupId]="group.id"></app-group-feed>
        </div>
        <div *ngIf="!joined" class="text-center text-gray-500 mt-6">
          Join the community to view and post in the feed.
        </div>
      </ng-container>

      <!-- CHAT -->
      <ng-container *ngIf="activeTab === 'chat'">
        <app-group-chat [groupId]="group.id" *ngIf="joined"></app-group-chat>
        <div *ngIf="!joined" class="p-6 text-center text-gray-600">
          Join to participate in chat & resources.
        </div>
      </ng-container>

      <!-- MEMBERS -->
      <ng-container *ngIf="activeTab === 'members'">
        <app-group-members
          [members]="(members$ | async) ?? []"
          (message)="openDm($event)"
        ></app-group-members>

        <app-dm-chat *ngIf="dmUserId" [participantId]="dmUserId"></app-dm-chat>
      </ng-container>

      <!-- RESOURCES -->
      <ng-container *ngIf="activeTab === 'resources'">
        <ng-container *ngIf="group$ | async as group">
          <app-group-resources [groupId]="group.id"></app-group-resources>
        </ng-container>
      </ng-container>
    </div>

    <app-dm-popup-host #dmHost></app-dm-popup-host>
  </ng-container>
</div>
